(function(c,f){function p(a,b,e){return c("<"+a+">").addClass("tpl-block-popup"+b).append(e)}function k(a,b){return p("div",a,b)}function t(a,b,e){return c("<input>",{type:"hidden",name:b,value:e}).appendTo(a)}function u(){if(0>l){var a=c("<div/>").css({position:"absolute",top:-1E3,left:-1E3,width:100,height:100,overflow:"auto"}).prependTo("body").append("<div/>").find("div").css({width:"100%",height:200});l=100-a.width();a.parent().remove()}return l}function n(a,b,e,d,m){b=k(b+" tpl-block-popup "+
a).data({closeAll:d,disableAnimation:m});var g=q(a);a=k("-container"+(m?"":" tpl-state-animated tpl-animation-fade-in-down"),[p("a","-close-button").click(g),k("-icon"),k("-body").html(e)]);b.append([k("-background").click(g),a]).appendTo("body");c(f).off("resize",h).on("resize",h);b.find("img").on("load",h);h();a=c("body");d=c(f);a.data("ncRequestsStyle")||a.data("ncRequestsStyle",a.attr("style")||" ");c(document).height()>d.height()&&(e=a.offset().left,d=d.width()-a.outerWidth(!0)-e,a.css({"overflow-y":"hidden",
"margin-left":e+"px","margin-right":d+u()+"px"}));a.off("keyup.popup-close").on("keyup.popup-close",function(a){27==a.keyCode&&g()});m?b.show():b.fadeIn();return b}function q(a){return function(){var b=".tpl-block-popup."+a,e=c(b),d=e.last();e=d.data("closeAll")?e:d;d=d.data("disableAnimation")?1:400;e.fadeOut(d,function(){c(this).remove()});setTimeout(function(){if(!c(b).length){c(f).off("resize",h);var a=c("body");a.attr("style",a.data("ncRequestsStyle")).data("ncRequestsStyle","").off("keyup.popup-close")}},
d+200)}}function h(){c(".tpl-block-popup").each(function(){var a=c(this),b=a.find(".tpl-block-popup-container").css("margin-top",""),e=parseInt(b.css("margin-top"),10);a=Math.round((a.innerHeight()-b.outerHeight())/2);a>e&&b.css("margin-top",a+"px")})}function r(a){return function(b,c,d){"abort"!=c&&n(a,"-message tpl-state-error","<h4>"+c+"</h4><p>"+d+"</p>",!1)}}var l=-1;f.nc_requests_form_init=function(a,b,e){b=c(b||"body").parent().find("."+a.replace(/\s+/,".")+" form");b.off("submit.ajax-submit").on("submit.ajax-submit",
function(b){b.preventDefault();if(e)return!1;b=c(this);c.ajax({type:b.attr("method"),url:b.attr("action"),data:b.serialize()+"&isNaked=1",success:function(b){var c=0>b.indexOf("error");n(a,c?"-message tpl-state-success":"-message tpl-state-error",b,c,!1)},error:r(a)})});e&&b.find("input,select,textarea,button").prop("tabindex",-1)};f.nc_requests_form_popup_init=function(a,b,e,d,m){var g=c(b);if(!g.length)throw"Button not found: "+b;var f=g.closest("form");f.length||(f=c("<form/>"),g.wrap(f));for(var k in d)t(f,
k,d[k]);m&&g.wrap(c("<div/>").css({position:"relative",display:"inline-block"})).after(m);var h=!!m,l;g.off("click.ajax-load").on("click.ajax-load",function(b){b.preventDefault();l&&l.abort();var d={type:"POST",url:f.attr("action")||e,data:f.serialize()+"&isNaked=1",success:function(b){nc_event_dispatch("nc_requests_form_popup_loaded");var c=n(a,"-form",b,!0,h).data({requestParameters:d,formBlockClasses:a});nc_requests_form_init(a,c,h);h||setTimeout(function(){c.find("input,select,textarea").filter(":visible").first().focus()},
450)},error:r(a)};l=c.ajax(d)})};f.nc_requests_form_popup_reload=function(){c(".tpl-block-popup").each(function(){var a=c(this),b=a.data("formBlockClasses");a=a.data("requestParameters");b&&a&&(c.ajax(a),c(document).one("nc_requests_form_popup_loaded",q(b)))})}})(jQuery,window);
