(function(k){var p={},q={ajax_path:(window.NETCAT_PATH||"/netcat/")+"action.php?ctrl=system.form.fields.data_source.data_source"},t=function(){return"console"in window?console.error.apply(console,arguments):null},n=function(e,l,g){e=k(document.createElement(e));for(var m in l)e.attr(m,l[m]);g&&e.append(g);return e},u=function(e,k,g){var m="";if(k)for(var h in k)m+=" "+h+'="'+k[h]+'"';return"<"+e+m+">"+(g||"")+"</"+e+">"},v=function(e){var l={},g={},m={},h=function(){var a=l,b;for(b in arguments){var c=
arguments[b];if(c in a)a=a[c];else return k.$()}return a},p=function(a,b){b=b||{};k.is_string(a)&&(a={action:a});var c="",d;for(d in a)c+="&"+d+"="+a[d];b.url=q.ajax_path+c;b.dataType||(b.dataType="json");b.type||(b.type="POST");return k.$.ajax(b)},c=function(){};c.init=function(a){var b=["container","field",["tabs","tabs>li"],["contents","contents>div"],"source_path","source_list","source_subclass","ordering_field","filter_field","bindings_tbody"],f;for(f in b){var d=b[f],n=d;k.is_string(d)||(n=
d[1],d=d[0]);l[d]=k("#"+e+"_"+n)}l.tab={};l.content={};l.tabs.each(function(a,b){var c=k(b).data("keyword");c&&(l.tab[c]=k(b))});l.contents.each(function(a,b){var c=k(b).data("keyword");c&&(l.content[c]=k(b),m[c]=!1)});c.set_value(a);c.process("init",{data:{field_value:g,field_name:e}});h("ordering_field").val("order_by"in g?g.order_by:"").keyup(function(){c.set_value({order_by:this.value})});h("filter_field").val("where"in g?g.where:"").keyup(function(){c.set_value({where:this.value})})};c.process=
function(a,b){b=b||{};b.success||(b.success=c.process_json);b.error=function(a){t(a.responseText)};p(a,b)};c.process_json=function(a){var b;if("call"in a)for(b in a.call){var f=a.call[b];k.is_string(f)&&(f=[f]);c[b].apply(c,f)}if("action"in a)for(b in a.action)c.process(b,{data:a.action[b]});if("tab_content"in a)for(b in a.tab_content)c.set_tab_content(b,a.tab_content[b]);if("enable_tab"in a)for(b in k.is_string(a.enable_tab)&&(a.enable_tab=[a.enable_tab]),a.enable_tab)c.enable_tab(a.enable_tab[b]);
"select_tab"in a&&c.select_tab(a.select_tab);"source_list"in a&&c.render_list(h("source_list"),a.source_list);"source_subclass"in a&&c.render_list(h("source_subclass"),a.source_subclass);"source_path"in a&&c.render_path(h("source_path"),a.source_path);"bindings_fields"in a&&c.render_bindings(h("bindings_tbody"),a.bindings_fields)};c.set_value=function(a,b){a=a||{};if(b)g=a;else for(var c in a)g[c]=a[c];h("field").val(JSON.stringify(g))};c.select_tab=function(a,b){if(b&&k(b).parents("li").hasClass("nc--disabled")||
h("tab",a).hasClass("nc--active"))return!1;m[a]||(c.process(a,{data:{field_value:g,field_name:e}}),m[a]=!0);h("tabs").removeClass("nc--active");c.enable_tab(a).addClass("nc--active");h("contents").slideUp();h("content",a).slideDown();return!1};c.enable_tab=function(a){return h("tab",a).removeClass("nc--disabled")};c.disable_tab=function(a){return h("tab",a).addClass("nc--disabled")};c.alert=function(a){alert(a)};c.render_list=function(a,b){for(var f=n("ul",{"class":"nc-list nc--hovered"}),d=0;d<b.length;d++)f.append(c.make_list_item(b[d],
!0));a.html(f)};c.render_path=function(a,b){for(var f=n("ul",{"class":"nc-path"}),d=0;d<b.length;d++)f.append(c.make_list_item(b[d]));a.html(f)};c.make_list_item=function(a,b){b=!0===b?"<span class='nc-actions nc--on-hover'><span><i class='nc-icon nc--arrow-right'></i></span></span>":b||"";var f="icon"in a?u("i",{"class":"nc-icon nc--"+a.icon})+" ":"",f=n("a",{href:"#","class":"nc--blocked"},f+a.title+b);f.click(function(){c.process_json(a);return!1});return n("li",!1,f)};c.render_bindings=function(a,
b){a.html("");"bindings"in g||(g.bindings={});var f=function(){var a=k(this).data("name");this.value?g.bindings[a]=this.value:delete g.bindings[a];c.set_value()},d;for(d in b){var e=n("tr"),h=n("input",{type:"text","data-name":d}).keyup(f).change(f);d in g.bindings&&h.val(g.bindings[d]);e.append("<td>"+d+"</td>");e.append("<td>"+b[d]+"</td>");e.append(n("td",!1,h));a.append(e)}};c.set_tab_content=function(a,b){return h("content",a).html(b)};return c},r=function(e){"undefined"===typeof p[e]&&(p[e]=
v(e));return p[e]};r.config=function(e){q=e};k.ext("data_source",r)})(nc);
