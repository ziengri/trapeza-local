(function(k,g,l,q,n,v,C){function w(a){a={newTemplateContent:a};var b;"function"!=typeof k[n]?(b=g.createEvent(n),b["init"+n]("ncPartialUpdate",!1,!1,a)):b=new k[n]("ncPartialUpdate",{detail:a});g.dispatchEvent(b)}function x(a){var b=[],c=g.createNodeIterator(g.body,NodeFilter.SHOW_COMMENT,null,!1),d,e,h,m,r;for(a&&(a=D(a));d=c.nextNode();)if(e=d.nodeValue.match(E))try{m=JSON.parse(e[2]),r=m.partial+t(m.data||{}),h={start:d,id:e[1],param:m,key:r,cacheKey:y+m.template+"_"+r},u(h),a&&!F(h,a)||b.push(h)}catch(f){v&&
v.log("Partial error:",f.message,d)}return b}function D(a){"string"==typeof a&&(a=[[a]]);f(a,function(b,c){"string"==typeof b&&(a[c]=b=[b]);b[0]=b[0].split(/\W+/)});return a}function u(a){for(var b=[],c=a.start;c=c.nextSibling;){if(8==c.nodeType&&-1!=c.nodeValue.indexOf("/nc_template_partial "+a.id))return b;b.push(c)}throw Error("No end comment");}function z(a,b){var c=a.start.parentNode;f(u(a),function(a){c.removeChild(a)});var d=c.insertBefore(g.createElement("DIV"),a.start.nextSibling);d.insertAdjacentHTML("afterend",
b);c.removeChild(d);A(u(a));a.param.store&&l.setItem(a.cacheKey,b)}function F(a,b){var c=!1,d=a.param,e=d.data;f(b,function(a){var b=a[1];if((a=-1!=a[0].indexOf(d.partial))&&!(a=b===C||null===b&&null===e)&&(a=b))a:{a=e||{};for(var f in b)if(a[f]!=b[f]){a=!1;break a}a=!0}if(a)return c=!0,!1});return c}function B(a,b,c){if(a.length){var d={partial:[]};f(a,function(a){d.template=a.param.template;a=a.key;var b=d.partial;-1==b.indexOf(a)&&b.push(a)});d.referer=location.toString();d.json=1;var e=new XMLHttpRequest,
h=(k.NETCAT_PATH||"/netcat/")+"partial.php"+t(d);e.open("GET",h,!0);e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status)try{var d=JSON.parse(e.responseText);G(a,d);w(d);b(d)}catch(f){c(e)}else c(e)};e.send()}}function G(a,b){f(a,function(a){a.key in b&&z(a,b[a.key])})}function t(a,b){var c=[],d,e;for(d in a)e=a[d],d=q(d),b&&(d=b+"["+d+"]"),e instanceof Array?f(e,function(a){c.push(d+"[]="+q(a))}):"object"==typeof e?c=c.concat(t(e,d)):c.push(d+"="+q(e));b||(c=c.length?"?"+c.join("&"):
"");return c}function A(a){f(a,function(a){if("SCRIPT"==a.tagName){var c=g.head,d=g.createElement("SCRIPT");d.appendChild(g.createTextNode(a.text));c.appendChild(d);c.removeChild(d)}else a.childNodes.length&&A(a.childNodes)})}function p(){}function f(a,b){for(var c=0;c<a.length&&!1!==b(a[c],c);c++);}k.nc_partial_load=function(a,b,c){B(x(a),b||p,c||p)};k.nc_partial_clear_cache=function(){for(var a in l)l.hasOwnProperty(a)&&!a.indexOf(y)&&l.removeItem(a)};g.addEventListener("DOMContentLoaded",function(){var a=
[],b={},c;f(x(),function(d){var e=d.param,f,g;e.defer&&(g=!0,e.store&&null!==(f=l.getItem(d.cacheKey))&&(z(d,f),b[d.key]=f,c=!0,g=!1));(g||e.reload)&&a.push(d)});c&&w(b);B(a,p,p)});var E=/nc_template_partial (\S+) ({.+})/,y="nc_partial_"})(window,document,sessionStorage,encodeURIComponent,"CustomEvent",console);
