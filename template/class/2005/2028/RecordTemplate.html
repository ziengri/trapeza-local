<?php /* Служебная часть */
for ($f_RowNum = 0; $f_RowNum < $rowCount; $f_RowNum++) {
    if($fetch_row[$f_RowNum] instanceof Iterator) {
        extract($fetch_row[$f_RowNum]->to_array(), EXTR_PREFIX_ALL, "f");
    } else {
        extract($fetch_row[$f_RowNum], EXTR_PREFIX_ALL, "f");
    }
    foreach($iteration_RecordTemplate[$f_RowNum] as $value) {
        extract($value);
    }
    eval($cc_env["convert2txt"]);
    ob_start();
/* Конец служебной части */?>

<?php 
$connectTemplate = $DOCUMENT_ROOT.$pathInc2."/template/{$classID}/2028/RecordTemplate.html";
if($current_catalogue['customCode'] && file_exists($connectTemplate)){
  include($connectTemplate);
}else{
?>


<tr data-id='<?=$f_RowID?>'>

        <td>
            <p><?=$f_RowID ?></p>

            <div class="div_products" style="display: none">

                <?php unset($totalsum); unset($totalnum);
                if (!$refcode)
                {
                    echo "<table style='margin-bottom: 20px'>
                        <tr>
                            <th>".getLangWord('profile_page_order_name','Наименование')."</th>
                            <th>".getLangWord('profile_page_order_quantity','Количество')."</th>
                            <th>".getLangWord('profile_page_order_summary','Сумма')."</th>
                        </tr>";

                    $items = orderArray($f_orderlist);
                    foreach($items[items] as $itemid => $item)
                    {
                        if (strstr($itemid,"_vr"))
                        {
                            $vrID = explode("_vr",$itemid);
                        }
                        $param = $db->get_row("select * from Message2001 where Message_ID = '$itemid'", ARRAY_A);
                        echo "<tr>";
                        echo "<td>".($param[name] ? "<a target=_blank href='".nc_message_link($itemid,2001).($vrID[1] ? "#v_{$vrID[1]}" : NULL)."'>$item[name]</a></td>" : getLangWord('profile_page_order_prod_noexist','Товар уже не существует'))."</td>";
                        echo "<td class='s'>".$item[count]."</td>";
                        echo "<td class='s'>".$item[sum]."<span class=rubl>Р</span></td>";
                        echo "</tr>";
                        $totalsum = $totalsum + $item[sum];
                        $totalnum = $totalnum + $item[count];
                    }
                    $alltotalsum = $alltotalsum + ($f_totalSum ? $f_totalSum : $totalsum);
                    echo "</table>";
                    }
                ?>
            </div>
        <a class="btn-strt-a button_set_visibility"><span><?=getLangWord('profile_page_show_order','Показать заказ')?> (<?=$totalnum?>)</span></a>
        </td>

        <td style='vertical-align: baseline;'>
            <?=$f_Created_day?>.<?=$f_Created_month ?>.<?=$f_Created_year?><br><?=$f_Created_hours?>:<?=$f_Created_minutes?>
        </td>

        <td style='vertical-align: baseline;'>
            <?=($f_totalSum ? $f_totalSum : ($totalsum ? $totalsum : "&mdash;"))?>
        </td>

        <td style='vertical-align: baseline;'>
            <?=((new Class2005())->getOrderStatusList()[$f_ShopOrderStatus]['name'] ?? getLangWord('profile_page_order_new','Новый')) ?>
            <?php 
                if (
                    $setting['rkassaPass1'] 
                    && $setting['rkassaPass2'] 
                    && $setting['rkassaLogin'] 
                    && (!$f_ShopOrderStatus || $f_ShopOrderStatus == 1)
                    && !$refcode
                ) {
                    // your registration data
                    $mrh_login = $setting['rkassaLogin'];
                    $mrh_pass1 = $setting['rkassaPass1'];

                    // order properties
                    $inv_id = $f_RowID;
                    $inv_desc  = "Заказ №{$f_RowID} в магазине {$current_catalogue['Catalogue_Name']}";
                    $out_summ  = str_replace(",",".",floatval(($f_totalSum ? $f_totalSum : ($totalsum ? $totalsum : "&mdash;"))));

                    // build CRC value
                    $crc  = md5("$mrh_login:$out_summ:$inv_id:$mrh_pass1");

                    // build URL
                    $payUrl = "https://auth.robokassa.ru/Merchant/Index.aspx?MrchLogin=$mrh_login&OutSum=$out_summ&InvId=$inv_id&Desc=$inv_desc&SignatureValue=$crc";
                    echo "<p class='payButton'><a target=_blank href='{$payUrl}'>".getLangWord('profile_page_pay_now','Оплатить сейчас')."</a></p>";
                }
            ?>
        </td>
    </tr>
    
<?php }?>

<?php /* Служебная часть */
    echo nc_finishing_RecordTemplate(ob_get_clean(), $inside_admin, $classID, $f_RowID, $parent_message, $cc, $cc_env["Class_Name"], $no_cache_marks);
}
/* Конец служебной части */?>