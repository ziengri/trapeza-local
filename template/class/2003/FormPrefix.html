<?=($inside_admin ? $f_AdminCommon : addObjBut($addLink,$isTitle,null,'новость', 0))?>

<?php
global $AUTH_USER_ID;
    if ($AUTH_USER_ID == 2109) {
        var_dump($cc_env);
    }
     
    # json раздела
    if(isJson($cc_env['settingsSub'])) $settingsSub = orderArray($cc_env['settingsSub']);
    # ширина объекта
    $sizeitemTotal = 0;
    if($sizehave){
        if($sizeitem_select=='count') $sizeitemTotal = $sizeitem_counts;
        else if($sizeitem && is_numeric($sizeitem)) $sizeitemTotal = $sizeitem;
    }
    if(!$sizeitemTotal && $settingsSub["sizehave"]){
        if($settingsSub["sizeitem_select"]=='count') $sizeitemTotal = $settingsSub["sizeitem_counts"];
        else if(is_numeric($settingsSub["sizeitem"])) $sizeitemTotal = $settingsSub["sizeitem"];
    }
    if(!$sizeitemTotal){
        if($setting["size".$classID."_select"]=='count') $sizeitemTotal = $setting["size".$classID."_counts"];
        else $sizeitemTotal = $setting["size".$classID];
    }
    # отступ
    if($sizehave && is_numeric($sizeitem_margin))  $margin = $sizeitem_margin;
    else if($settingsSub["sizehave"] && is_numeric($settingsSub["sizeitem_margin"])) $margin = $settingsSub["sizeitem_margin"];
    else if(is_numeric($setting["size".$classID."_margin"])) $margin = $setting["size".$classID."_margin"];
    else $margin = 15;
    # Шаблон вывода
    $subDataTemplate = json_decode($nc_core->subdivision->get_by_id($cc_env['Subdivision_ID'])['settingsSub'])->template;
    
    if (!$subDataTemplate) $subDataTemplate = "template-1";

    if($template_block) $template = $template_block;
    else if($settingsSub["template"]) $template = $settingsSub["template"];
    else if($subDataTemplate) $template = $subDataTemplate;
    else if($setting["size".$classID."_template"]) $template = $setting["size".$classID."_template"];

    # Открывать в модальном окне
    if($objInModal) $objInModal = $objInModal;
    else if($settingsSub["objInModal"]) $objInModal = $settingsSub["objInModal"];
    else if($setting["size".$classID."_objinmodal"]) $objInModal = $setting["size".$classID."_objinmodal"];
    if (!$objInModal) {
        $subVar = $db->get_row(
            "SELECT 
                a.*, 
                b.Class_ID, 
                b.SortBy 
            FROM 
                Subdivision as a, 
                Sub_Class as b 
            WHERE
                a.Subdivision_ID = '{$cc_env['Subdivision_ID']}' 
                AND (
                    a.Subdivision_ID = b.Subdivision_ID 
                    OR a.Hidden_URL='/index/'
                ) 
                AND a.Catalogue_ID = '{$catalogue}' 
            ORDER BY 
                b.Priority 
            LIMIT 0,1",
            ARRAY_A
        );

        if ($subVar['Class_ID']) {
            $arrSubSett = orderArray($subVar['settingsSub']);
        }
        $objInModal = $arrSubSett['objInModal'];
    }
    
    $data = subdivisionData(array(
        'type' => 'news',
        'sizeitem' => $sizeitemTotal,
        'margin' => $margin,
        'imagefit' => $imagefit,
        'scrolling' => $scrolling,
        'scrollspeed' => $scrollspeed,
        'scrollNav' => $scrollNav,
        'scrollDots' => $scrollDots,
        'autoplay' => $autoplay,
        'template' => $template
    ));

    # animate
    $animateKey = "";
    $animateDelay = 0;
    $animateDelayStep = 0.16;
    if($animate){
        if($animate_title && $animate_title != "_empty_") $animateDelay += $animateDelayStep;
        if($animate_text && $animate_text != "_empty_") $animateDelay += $animateDelayStep;
        if($animate_items && $animate_items != "_empty_") $animateKey = $animate_items;
    }
    if(!$animateKey && $settingsSub["animate"]){
        if($settingsSub["animate_title"] && $settingsSub["animate_title"] != "_empty_") $animateDelay += $animateDelayStep;
        if($settingsSub["animate_text"] && $settingsSub["animate_text"] != "_empty_") $animateDelay += $animateDelayStep;
        if($settingsSub["animate_items"] && $settingsSub["animate_items"] != "_empty_") $animateKey = $settingsSub["animate_items"];
    }
    if(!$animateKey){
        if($setting["size".$classID."_animate"] && $setting["size".$classID."_animate"] != "_empty_") $animateKey = $setting["size".$classID."_animate"];
    }
    if($animateKey) $animateKey = "wow {$animateKey}";
?>

<?php  if ($totRows) { ?>
 <?php
        if (!$isTitle) {
            echo getSubdivisionTagsHtml(
                getTagsFromSubdivision($classID, $sub),
                $current_sub['Hidden_URL'].vars_str($_GET, "recNum,nc_ctpl,curPos,sort"),
                $tag
            );
        }
    ?>


	<ul class='<?=$data['class']?>' <?=$data['attr']?>>
<?php  } ?>

<?php  if(!$totRows){ ?> <p class='no-obj'>Новостей не найдено</p> <?php }?>