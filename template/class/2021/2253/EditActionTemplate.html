<?
$connectTemplate = $DOCUMENT_ROOT.$pathInc2."/template/{$classID}/templateEdit/EditActionTemplate.html";
if($current_catalogue['customCode'] && file_exists($connectTemplate)){
  include($connectTemplate);
}else{

  global $setting;
  if (!$inside_admin) actionObject($classID, $message, $f_Checked, $Checked);
    $waterPosition = ($setting[waterPosition] ? ($setting[waterPosition]==5 ? "0" : $setting[waterPosition]) : 4);
  
  clearCache($classID,$sub);
  
  if (!$inside_admin) objsys($bc_objsys,$classID,$message);
  
  if ($pathInc && file_exists($DOCUMENT_ROOT.$pathInc.'/images/watermark.png')) {
    @require_once($INCLUDE_FOLDER."classes/nc_imagetransform.class.php");
     
    $photos = $db->get_results("select Preview, Path, ID from Multifield where Size != '1' AND Message_ID = '$message' AND Field_ID = '2462'", ARRAY_A);
    if ($photos) {
      foreach($photos as $fot) {
        if (!$notWater) {
          nc_ImageTransform::putWatermark_file($fot[Path], $pathInc.'/images/watermark.png', $waterPosition);
          nc_ImageTransform::putWatermark_file($fot[Preview], $pathInc.'/images/watermark.png', $waterPosition);
        }
        $db->query("UPDATE Multifield set Size = '1' where ID = '$fot[ID]'");
      }
    }
  }
  
  
  if($inside_admin) {
      ob_end_clean();
      header('Location: '.$goBackLink.'&inside_admin=1');
      exit;
  } else { 
      echo json_encode(ARRAY(
          "title" => "ОК",
          "succes" =>  NETCAT_MODERATION_MSG_OBJCHANGED,
          "reload" => 1
      ));
  }
}
?>