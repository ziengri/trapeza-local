<!-- FormPrefix --><?php

$caheDir = $DOCUMENT_ROOT.$pathInc.'/var';

if (!file_exists($caheDir)) mkdir($caheDir, 777);

$cacheFile = $caheDir.'/unique_items_cache.json';

$data = [];
if (file_exists($cacheFile) && !(filectime($cacheFile) + 86400 < date('U'))) {
    $data = json_decode(file_get_contents($cacheFile), true) ?: [];
}

if (!$data) {
    $sql = "SELECT `Message_ID` AS id, `price`, `name`
            FROM `Message2001`
            WHERE `Catalogue_ID` = {$catalogue}
                AND `Checked` = 1";
    $data = $db->get_results($sql, ARRAY_A);
    file_put_contents($cacheFile, json_encode($data, JSON_UNESCAPED_UNICODE));
}

$uniqueItems = new ItemsUnique($data, (int) $id, (int) $city_id);
$list = $uniqueItems->getUniqueList(4, 50);

if ($list) : 
?>
    <ul class="catalog-unique-list">
        <?php foreach ($list as $item) : ?>
            <li>
                <?php $href = nc_message_link($item['id'], 2001); ?>
                <?php if ($href) : ?><a href="<?= $href ?>"><?php endif; ?>
                    <?= $item['name'] ?>
                <?php if ($href) : ?></a><?php endif; ?>
            </li>
        <?php endforeach; ?>
    </ul>
<?php endif; ?><!-- /FormPrefix -->

<!-- RecordTemplate --><?php /* Служебная часть */for ($f_RowNum = 0; $f_RowNum < $rowCount; $f_RowNum++) {    if($fetch_row[$f_RowNum] instanceof Iterator) {        extract($fetch_row[$f_RowNum]->to_array(), EXTR_PREFIX_ALL, "f");    } else {        extract($fetch_row[$f_RowNum], EXTR_PREFIX_ALL, "f");    }    foreach($iteration_RecordTemplate[$f_RowNum] as $value) {        extract($value);    }    eval($cc_env["convert2txt"]);    ob_start();/* Конец служебной части */?>

<?php /* Служебная часть */    echo nc_finishing_RecordTemplate(ob_get_clean(), $inside_admin, $classID, $f_RowID, $parent_message, $cc, $cc_env["Class_Name"], $no_cache_marks);}/* Конец служебной части */?><!-- /RecordTemplate -->

<!-- FormSuffix --><!-- /FormSuffix -->