(function(n){function x(a,c){if(d.test(a)&&l.test(c))a="right";else if(l.test(a)&&d.test(c))a="left";else if(e.test(a)&&w.test(c))a="bottom";else if(w.test(a)&&e.test(c))a="top";else return"";return"tpl-dropdown-to-"+a}var l=/left/,d=/right/,w=/top/,e=/bottom/,p=n("body"),q;window.nc_visibility_dropdown=function(a){function c(a){f.css({visibility:"hidden",top:0,left:0,zIndex:9E3,overflow:"visible"}).show().position({my:g,at:d,of:h,collision:b.on_collision}).css("visibility","").addClass("tpl-dropdown-visible");
k=!0;a&&"click"===a.type?(a.preventDefault(),r=!0):r=!1;p.on("click",t)}function u(){f.hide().removeClass("tpl-dropdown-visible");m=k=!1;p.off("click",t)}function t(a){var b=n(a.target);k&&"click"===a.type&&!b.closest(h).length&&(u(),r&&a.preventDefault())}var f=n(a.block_element),h=f.parent(".tpl-dropdown-trigger, .tpl-block-list, .tpl-container"),b=a.settings,d=b.trigger_anchor,g=b.dropdown_anchor;a=b.gap_vertical;var v=b.gap_horizontal,l="hover"===b.show_trigger,e=x(d,g),k=!1,r=!1,m;h.addClass("tpl-dropdown-trigger "+
e);f.addClass("tpl-dropdown").hide();parseInt(v)&&(g=g.replace(" ",(0<=v?"+":"")+v+b.gap_horizontal_unit+" "));parseInt(a)&&(g+=(0<=a?"+":"")+a+b.gap_vertical_unit);h.on("click.nc_visibility_dropdown",function(a){k?t(a):c(a)}).on("mouseenter.nc_visibility_dropdown",function(a){if(l||p.find(".tpl-dropdown-visible").length)clearTimeout(q),clearTimeout(m),q=setTimeout(function(){c(a)},301)}).on("mouseleave.nc_visibility_dropdown",function(){k&&(m=setTimeout(function(){u()},300))});this.destroy=function(){clearTimeout(q);
clearTimeout(m);u();h.off(".nc_visibility_dropdown").removeClass(e);f.css({top:"",left:"",zIndex:"",overflow:""}).removeClass("tpl-dropdown").show()}}})(jQuery);
