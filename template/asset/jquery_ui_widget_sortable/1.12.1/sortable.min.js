(function(e){"function"===typeof define&&define.amd?define("jquery,./mouse,../data,../ie,../scroll-parent,../version,../widget".split(","),e):e(jQuery)})(function(e){return e.widget("ui.sortable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,
scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1E3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(a,b,c){return a>=b&&a<b+c},_isFloating:function(a){return/left|right/.test(a.css("float"))||/inline|table-cell/.test(a.css("display"))},_create:function(){this.containerCache={};this._addClass("ui-sortable");this.refresh();this.offset=this.element.offset();
this._mouseInit();this._setHandleClassName();this.ready=!0},_setOption:function(a,b){this._super(a,b);"handle"===a&&this._setHandleClassName()},_setHandleClassName:function(){var a=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle");e.each(this.items,function(){a._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var a=this.items.length-1;0<=a;a--)this.items[a].item.removeData(this.widgetName+
"-item");return this},_mouseCapture:function(a,b){var c=null,d=!1,f=this;if(this.reverting||this.options.disabled||"static"===this.options.type)return!1;this._refreshItems(a);e(a.target).parents().each(function(){if(e.data(this,f.widgetName+"-item")===f)return c=e(this),!1});e.data(a.target,f.widgetName+"-item")===f&&(c=e(a.target));if(!c||this.options.handle&&!b&&(e(this.options.handle,c).find("*").addBack().each(function(){this===a.target&&(d=!0)}),!d))return!1;this.currentItem=c;this._removeCurrentsFromItems();
return!0},_mouseStart:function(a,b,c){var d,b=this.options;this.currentContainer=this;this.refreshPositions();this.appendTo=e("parent"!==b.appendTo?b.appendTo:this.currentItem.parent());this.helper=this._createHelper(a);this._cacheHelperProportions();this._cacheMargins();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};e.extend(this.offset,{click:{left:a.pageX-this.offset.left,top:a.pageY-this.offset.top},relative:this._getRelativeOffset()});
this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");b.cursorAt&&this._adjustOffsetFromHelper(b.cursorAt);this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};this.helper[0]!==this.currentItem[0]&&this.currentItem.hide();this._createPlaceholder();this.scrollParent=this.placeholder.scrollParent();e.extend(this.offset,{parent:this._getParentOffset()});b.containment&&this._setContainment();if(b.cursor&&"auto"!==b.cursor)d=this.document.find("body"),
this.storedCursor=d.css("cursor"),d.css("cursor",b.cursor),this.storedStylesheet=e("<style>*{ cursor: "+b.cursor+" !important; }</style>").appendTo(d);if(b.zIndex){if(this.helper.css("zIndex"))this._storedZIndex=this.helper.css("zIndex");this.helper.css("zIndex",b.zIndex)}if(b.opacity){if(this.helper.css("opacity"))this._storedOpacity=this.helper.css("opacity");this.helper.css("opacity",b.opacity)}if(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName)this.overflowOffset=
this.scrollParent.offset();this._trigger("start",a,this._uiHash());this._preserveHelperProportions||this._cacheHelperProportions();if(!c)for(c=this.containers.length-1;0<=c;c--)this.containers[c]._trigger("activate",a,this._uiHash(this));if(e.ui.ddmanager)e.ui.ddmanager.current=this;e.ui.ddmanager&&!b.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,a);this.dragging=!0;this._addClass(this.helper,"ui-sortable-helper");if(!this.helper.parent().is(this.appendTo))this.helper.detach().appendTo(this.appendTo),
this.offset.parent=this._getParentOffset();this.position=this.originalPosition=this._generatePosition(a);this.originalPageX=a.pageX;this.originalPageY=a.pageY;this.lastPositionAbs=this.positionAbs=this._convertPositionTo("absolute");this._mouseDrag(a);return!0},_scroll:function(a){var b=this.options,c=!1;if(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName){if(this.overflowOffset.top+this.scrollParent[0].offsetHeight-a.pageY<b.scrollSensitivity)this.scrollParent[0].scrollTop=
c=this.scrollParent[0].scrollTop+b.scrollSpeed;else if(a.pageY-this.overflowOffset.top<b.scrollSensitivity)this.scrollParent[0].scrollTop=c=this.scrollParent[0].scrollTop-b.scrollSpeed;if(this.overflowOffset.left+this.scrollParent[0].offsetWidth-a.pageX<b.scrollSensitivity)this.scrollParent[0].scrollLeft=c=this.scrollParent[0].scrollLeft+b.scrollSpeed;else if(a.pageX-this.overflowOffset.left<b.scrollSensitivity)this.scrollParent[0].scrollLeft=c=this.scrollParent[0].scrollLeft-b.scrollSpeed}else a.pageY-
this.document.scrollTop()<b.scrollSensitivity?c=this.document.scrollTop(this.document.scrollTop()-b.scrollSpeed):this.window.height()-(a.pageY-this.document.scrollTop())<b.scrollSensitivity&&(c=this.document.scrollTop(this.document.scrollTop()+b.scrollSpeed)),a.pageX-this.document.scrollLeft()<b.scrollSensitivity?c=this.document.scrollLeft(this.document.scrollLeft()-b.scrollSpeed):this.window.width()-(a.pageX-this.document.scrollLeft())<b.scrollSensitivity&&(c=this.document.scrollLeft(this.document.scrollLeft()+
b.scrollSpeed));return c},_mouseDrag:function(a){var b,c,d,f;b=this.options;this.position=this._generatePosition(a);this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||"y"!==this.options.axis)this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||"x"!==this.options.axis)this.helper[0].style.top=this.position.top+"px";this._contactContainers(a);if(null!==this.innermostContainer){b.scroll&&!1!==this._scroll(a)&&(this._refreshItemPositions(!0),e.ui.ddmanager&&
!b.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,a));this.dragDirection={vertical:this._getDragVerticalDirection(),horizontal:this._getDragHorizontalDirection()};for(b=this.items.length-1;0<=b;b--)if(c=this.items[b],d=c.item[0],(f=this._intersectsWithPointer(c))&&c.instance===this.currentContainer&&d!==this.currentItem[0]&&this.placeholder[1===f?"next":"prev"]()[0]!==d&&!e.contains(this.placeholder[0],d)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],d):1)){this.direction=1===
f?"down":"up";if("pointer"===this.options.tolerance||this._intersectsWithSides(c))this._rearrange(a,c);else break;this._trigger("change",a,this._uiHash());break}}e.ui.ddmanager&&e.ui.ddmanager.drag(this,a);this._trigger("sort",a,this._uiHash());this.lastPositionAbs=this.positionAbs;return!1},_mouseStop:function(a,b){if(a){e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,a);if(this.options.revert){var c=this,d=this.placeholder.offset(),f=this.options.axis,g={};if(!f||"x"===f)g.left=
d.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft);if(!f||"y"===f)g.top=d.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop);this.reverting=!0;e(this.helper).animate(g,parseInt(this.options.revert,10)||500,function(){c._clear(a)})}else this._clear(a,b);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new e.Event("mouseup",{target:null}));
"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var a=this.containers.length-1;0<=a;a--)if(this.containers[a]._trigger("deactivate",null,this._uiHash(this)),this.containers[a].containerCache.over)this.containers[a]._trigger("out",null,this._uiHash(this)),this.containers[a].containerCache.over=0}this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),
"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem));return this},serialize:function(a){var b=this._getItemsAsjQuery(a&&a.connected),c=[],a=a||{};e(b).each(function(){var b=(e(a.item||this).attr(a.attribute||"id")||"").match(a.expression||/(.+)[\-=_](.+)/);b&&c.push((a.key||
b[1]+"[]")+"="+(a.key&&a.expression?b[1]:b[2]))});!c.length&&a.key&&c.push(a.key+"=");return c.join("&")},toArray:function(a){var b=this._getItemsAsjQuery(a&&a.connected),c=[],a=a||{};b.each(function(){c.push(e(a.item||this).attr(a.attribute||"id")||"")});return c},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,g=a.left,j=g+a.width,i=a.top,k=i+a.height,h=this.offset.click.top,l=this.offset.click.left,
l="y"===this.options.axis||b+l>g&&b+l<j,h=("x"===this.options.axis||d+h>i&&d+h<k)&&l;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?h:g<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<j&&i<d+this.helperProportions.height/2&&e-this.helperProportions.height/2<k},_intersectsWithPointer:function(a){var b;b="x"===this.options.axis||
this._isOverAxis(this.positionAbs.top+this.offset.click.top,a.top,a.height);a="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,a.left,a.width);if(!b||!a)return!1;b=this.dragDirection.vertical;a=this.dragDirection.horizontal;return this.floating?"right"===a||"down"===b?2:1:b&&("down"===b?2:1)},_intersectsWithSides:function(a){var b=this._isOverAxis(this.positionAbs.top+this.offset.click.top,a.top+a.height/2,a.height),a=this._isOverAxis(this.positionAbs.left+this.offset.click.left,
a.left+a.width/2,a.width),c=this.dragDirection.vertical,d=this.dragDirection.horizontal;return this.floating&&d?"right"===d&&a||"left"===d&&!a:c&&("down"===c&&b||"up"===c&&!b)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return 0!==a&&(0<a?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return 0!==a&&(0<a?"right":"left")},refresh:function(a){this._refreshItems(a);this._setHandleClassName();this.refreshPositions();
return this},_connectWith:function(){var a=this.options;return a.connectWith.constructor===String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(a){function b(){g.push(this)}var c,d,f,g=[],j=[],i=this._connectWith();if(i&&a)for(a=i.length-1;0<=a;a--){d=e(i[a],this.document[0]);for(c=d.length-1;0<=c;c--)(f=e.data(d[c],this.widgetFullName))&&f!==this&&!f.options.disabled&&j.push([e.isFunction(f.options.items)?f.options.items.call(f.element):e(f.options.items,f.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),
f])}j.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(a=j.length-1;0<=a;a--)j[a][0].each(b);return e(g)},_removeCurrentsFromItems:function(){var a=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(b){for(var c=0;c<a.length;c++)if(a[c]===b.item[0])return!1;return!0})},_refreshItems:function(a){this.items=
[];this.containers=[this];var b,c,d,f,g,j=this.items,i=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],a,{item:this.currentItem}):e(this.options.items,this.element),this]];if((g=this._connectWith())&&this.ready)for(b=g.length-1;0<=b;b--){d=e(g[b],this.document[0]);for(c=d.length-1;0<=c;c--)if((f=e.data(d[c],this.widgetFullName))&&f!==this&&!f.options.disabled)i.push([e.isFunction(f.options.items)?f.options.items.call(f.element[0],a,{item:this.currentItem}):e(f.options.items,
f.element),f]),this.containers.push(f)}for(b=i.length-1;0<=b;b--){a=i[b][1];d=i[b][0];for(c=0,g=d.length;c<g;c++)f=e(d[c]),f.data(this.widgetName+"-item",a),j.push({item:f,instance:a,width:0,height:0,left:0,top:0})}},_refreshItemPositions:function(a){var b,c,d;for(b=this.items.length-1;0<=b;b--)if(c=this.items[b],!this.currentContainer||!(c.instance!==this.currentContainer&&c.item[0]!==this.currentItem[0])){d=this.options.toleranceElement?e(this.options.toleranceElement,c.item):c.item;if(!a)c.width=
d.outerWidth(),c.height=d.outerHeight();d=d.offset();c.left=d.left;c.top=d.top}},refreshPositions:function(a){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1;null!==this.innermostContainer&&this._refreshItemPositions(a);var b;if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(a=this.containers.length-1;0<=a;a--)b=this.containers[a].element.offset(),this.containers[a].containerCache.left=
b.left,this.containers[a].containerCache.top=b.top,this.containers[a].containerCache.width=this.containers[a].element.outerWidth(),this.containers[a].containerCache.height=this.containers[a].element.outerHeight();return this},_createPlaceholder:function(a){var a=a||this,b,c,d=a.options;if(!d.placeholder||d.placeholder.constructor===String)b=d.placeholder,c=a.currentItem[0].nodeName.toLowerCase(),d.placeholder={element:function(){var d=e("<"+c+">",a.document[0]);a._addClass(d,"ui-sortable-placeholder",
b||a.currentItem[0].className)._removeClass(d,"ui-sortable-helper");"tbody"===c?a._createTrPlaceholder(a.currentItem.find("tr").eq(0),e("<tr>",a.document[0]).appendTo(d)):"tr"===c?a._createTrPlaceholder(a.currentItem,d):"img"===c&&d.attr("src",a.currentItem.attr("src"));b||d.css("visibility","hidden");return d},update:function(e,g){if(!b||d.forcePlaceholderSize){if(!g.height()||d.forcePlaceholderSize&&("tbody"===c||"tr"===c))g.height(a.currentItem.innerHeight()-parseInt(a.currentItem.css("paddingTop")||
0,10)-parseInt(a.currentItem.css("paddingBottom")||0,10));g.width()||g.width(a.currentItem.innerWidth()-parseInt(a.currentItem.css("paddingLeft")||0,10)-parseInt(a.currentItem.css("paddingRight")||0,10))}}};a.placeholder=e(d.placeholder.element.call(a.element,a.currentItem));a.currentItem.after(a.placeholder);d.placeholder.update(a,a.placeholder)},_createTrPlaceholder:function(a,b){var c=this;a.children().each(function(){e("<td>&#160;</td>",c.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(b)})},
_contactContainers:function(a){var l;var b,c,d,f,g,j,i,k,h=f=null;for(b=this.containers.length-1;0<=b;b--)if(!e.contains(this.currentItem[0],this.containers[b].element[0]))if(this._intersectsWith(this.containers[b].containerCache)){if(!f||!e.contains(this.containers[b].element[0],f.element[0]))f=this.containers[b],h=b}else if(this.containers[b].containerCache.over)this.containers[b]._trigger("out",a,this._uiHash(this)),this.containers[b].containerCache.over=0;if(this.innermostContainer=f)if(1===this.containers.length){if(!this.containers[h].containerCache.over)this.containers[h]._trigger("over",
a,this._uiHash(this)),this.containers[h].containerCache.over=1}else{b=1E4;d=null;l=(c=f.floating||this._isFloating(this.currentItem))?"left":"top",f=l;g=c?"width":"height";k=c?"pageX":"pageY";for(c=this.items.length-1;0<=c;c--)if(e.contains(this.containers[h].element[0],this.items[c].item[0])&&this.items[c].item[0]!==this.currentItem[0]&&(j=this.items[c].item.offset()[f],i=!1,a[k]-j>this.items[c][g]/2&&(i=!0),Math.abs(a[k]-j)<b))b=Math.abs(a[k]-j),d=this.items[c],this.direction=i?"up":"down";if(d||
this.options.dropOnEmpty)if(this.currentContainer===this.containers[h]){if(!this.currentContainer.containerCache.over)this.containers[h]._trigger("over",a,this._uiHash()),this.currentContainer.containerCache.over=1}else{d?this._rearrange(a,d,null,!0):this._rearrange(a,null,this.containers[h].element,!0);this._trigger("change",a,this._uiHash());this.containers[h]._trigger("change",a,this._uiHash(this));this.currentContainer=this.containers[h];this.options.placeholder.update(this.currentContainer,this.placeholder);
this.scrollParent=this.placeholder.scrollParent();if(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName)this.overflowOffset=this.scrollParent.offset();this.containers[h]._trigger("over",a,this._uiHash(this));this.containers[h].containerCache.over=1}}},_createHelper:function(a){var b=this.options,a=e.isFunction(b.helper)?e(b.helper.apply(this.element[0],[a,this.currentItem])):"clone"===b.helper?this.currentItem.clone():this.currentItem;a.parents("body").length||this.appendTo[0].appendChild(a[0]);
if(a[0]===this.currentItem[0])this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")};(!a[0].style.width||b.forceHelperSize)&&a.width(this.currentItem.width());(!a[0].style.height||b.forceHelperSize)&&a.height(this.currentItem.height());return a},_adjustOffsetFromHelper:function(a){"string"===typeof a&&(a=a.split(" "));e.isArray(a)&&(a={left:+a[0],top:+a[1]||
0});if("left"in a)this.offset.click.left=a.left+this.margins.left;if("right"in a)this.offset.click.left=this.helperProportions.width-a.right+this.margins.left;if("top"in a)this.offset.click.top=a.top+this.margins.top;if("bottom"in a)this.offset.click.top=this.helperProportions.height-a.bottom+this.margins.top},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var a=this.offsetParent.offset();"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],
this.offsetParent[0])&&(a.left+=this.scrollParent.scrollLeft(),a.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)a={top:0,left:0};return{top:a.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:a.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.currentItem.position();
return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var a,
b,c;b=this.options;if("parent"===b.containment)b.containment=this.helper[0].parentNode;if("document"===b.containment||"window"===b.containment)this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===b.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===b.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-
this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(b.containment))a=e(b.containment)[0],b=e(b.containment).offset(),c="hidden"!==e(a).css("overflow"),this.containment=[b.left+(parseInt(e(a).css("borderLeftWidth"),10)||0)+(parseInt(e(a).css("paddingLeft"),10)||0)-this.margins.left,b.top+(parseInt(e(a).css("borderTopWidth"),10)||0)+(parseInt(e(a).css("paddingTop"),10)||0)-this.margins.top,b.left+(c?Math.max(a.scrollWidth,a.offsetWidth):a.offsetWidth)-(parseInt(e(a).css("borderLeftWidth"),
10)||0)-(parseInt(e(a).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,b.top+(c?Math.max(a.scrollHeight,a.offsetHeight):a.offsetHeight)-(parseInt(e(a).css("borderTopWidth"),10)||0)-(parseInt(e(a).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]},_convertPositionTo:function(a,b){if(!b)b=this.position;var c="absolute"===a?1:-1,d="absolute"===this.cssPosition&&!(this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0]))?
this.offsetParent:this.scrollParent,f=/(html|body)/i.test(d[0].tagName);return{top:b.top+this.offset.relative.top*c+this.offset.parent.top*c-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():f?0:d.scrollTop())*c,left:b.left+this.offset.relative.left*c+this.offset.parent.left*c-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():f?0:d.scrollLeft())*c}},_generatePosition:function(a){var b,c,d=this.options;c=a.pageX;b=a.pageY;var f="absolute"===this.cssPosition&&!(this.scrollParent[0]!==
this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,g=/(html|body)/i.test(f[0].tagName);if("relative"===this.cssPosition&&!(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]))this.offset.relative=this._getRelativeOffset();this.originalPosition&&(this.containment&&(a.pageX-this.offset.click.left<this.containment[0]&&(c=this.containment[0]+this.offset.click.left),a.pageY-this.offset.click.top<this.containment[1]&&
(b=this.containment[1]+this.offset.click.top),a.pageX-this.offset.click.left>this.containment[2]&&(c=this.containment[2]+this.offset.click.left),a.pageY-this.offset.click.top>this.containment[3]&&(b=this.containment[3]+this.offset.click.top)),d.grid&&(b=this.originalPageY+Math.round((b-this.originalPageY)/d.grid[1])*d.grid[1],b=this.containment?b-this.offset.click.top>=this.containment[1]&&b-this.offset.click.top<=this.containment[3]?b:b-this.offset.click.top>=this.containment[1]?b-d.grid[1]:b+d.grid[1]:
b,c=this.originalPageX+Math.round((c-this.originalPageX)/d.grid[0])*d.grid[0],c=this.containment?c-this.offset.click.left>=this.containment[0]&&c-this.offset.click.left<=this.containment[2]?c:c-this.offset.click.left>=this.containment[0]?c-d.grid[0]:c+d.grid[0]:c));return{top:b-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():g?0:f.scrollTop()),left:c-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+
("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():g?0:f.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?b.item[0]:b.item[0].nextSibling);var e=this.counter=this.counter?++this.counter:1;this._delay(function(){e===this.counter&&this.refreshPositions(!d)})},_clear:function(a,b){function c(a,b,c){return function(d){c._trigger(a,d,b._uiHash(b))}}this.reverting=!1;var d,e=[];!this._noFinalSort&&
this.currentItem.parent().length&&this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(d in this._storedCSS)if("auto"===this._storedCSS[d]||"static"===this._storedCSS[d])this._storedCSS[d]="";this.currentItem.css(this._storedCSS);this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!b&&e.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))});(this.fromOutside||this.domPosition.prev!==
this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!==this.currentItem.parent()[0])&&!b&&e.push(function(a){this._trigger("update",a,this._uiHash())});this!==this.currentContainer&&!b&&(e.push(function(a){this._trigger("remove",a,this._uiHash())}),e.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.currentContainer)),e.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.currentContainer)));
for(d=this.containers.length-1;0<=d;d--)if(b||e.push(c("deactivate",this,this.containers[d])),this.containers[d].containerCache.over)e.push(c("out",this,this.containers[d])),this.containers[d].containerCache.over=0;this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove());this._storedOpacity&&this.helper.css("opacity",this._storedOpacity);this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex);this.dragging=
!1;b||this._trigger("beforeStop",a,this._uiHash());this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(!this.cancelHelperRemoval)this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null;if(!b){for(d=0;d<e.length;d++)e[d].call(this,a);this._trigger("stop",a,this._uiHash())}this.fromOutside=!1;return!this.cancelHelperRemoval},_trigger:function(){!1===e.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(a){var b=a||this;return{helper:b.helper,
placeholder:b.placeholder||e([]),position:b.position,originalPosition:b.originalPosition,offset:b.positionAbs,item:b.currentItem,sender:a?a.element:null}}})});
