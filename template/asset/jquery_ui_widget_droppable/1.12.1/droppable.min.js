(function(d){"function"===typeof define&&define.amd?define(["jquery","./draggable","./mouse","../version","../widget"],d):d(jQuery)})(function(d){d.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var a,b=this.options,c=b.accept;this.isover=!1;this.isout=!0;this.accept=d.isFunction(c)?c:function(a){return a.is(c)};this.proportions=
function(){if(arguments.length)a=arguments[0];else return a?a:a={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}};this._addToManager(b.scope);b.addClasses&&this._addClass("ui-droppable")},_addToManager:function(a){d.ui.ddmanager.droppables[a]=d.ui.ddmanager.droppables[a]||[];d.ui.ddmanager.droppables[a].push(this)},_splice:function(a){for(var b=0;b<a.length;b++)a[b]===this&&a.splice(b,1)},_destroy:function(){this._splice(d.ui.ddmanager.droppables[this.options.scope])},_setOption:function(a,
b){"accept"===a?this.accept=d.isFunction(b)?b:function(a){return a.is(b)}:"scope"===a&&(this._splice(d.ui.ddmanager.droppables[this.options.scope]),this._addToManager(b));this._super(a,b)},_activate:function(a){var b=d.ui.ddmanager.current;this._addActiveClass();b&&this._trigger("activate",a,this.ui(b))},_deactivate:function(a){var b=d.ui.ddmanager.current;this._removeActiveClass();b&&this._trigger("deactivate",a,this.ui(b))},_over:function(a){var b=d.ui.ddmanager.current;if(b&&(b.currentItem||b.element)[0]!==
this.element[0])if(this.accept.call(this.element[0],b.currentItem||b.element))this._addHoverClass(),this._trigger("over",a,this.ui(b))},_out:function(a){var b=d.ui.ddmanager.current;if(b&&(b.currentItem||b.element)[0]!==this.element[0])if(this.accept.call(this.element[0],b.currentItem||b.element))this._removeHoverClass(),this._trigger("out",a,this.ui(b))},_drop:function(a,b){var c=b||d.ui.ddmanager.current,h=!1;if(!c||(c.currentItem||c.element)[0]===this.element[0])return!1;this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var b=
d(this).droppable("instance");if(b.options.greedy&&!b.options.disabled&&b.options.scope===c.options.scope&&b.accept.call(b.element[0],c.currentItem||c.element)&&d.ui.intersect(c,d.extend(b,{offset:b.element.offset()}),b.options.tolerance,a))return h=!0,!1});if(h)return!1;return this.accept.call(this.element[0],c.currentItem||c.element)?(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",a,this.ui(c)),this.element):!1},ui:function(a){return{draggable:a.currentItem||a.element,helper:a.helper,
position:a.position,offset:a.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});d.ui.intersect=function(){return function(a,b,c,d){if(!b.offset)return!1;var e=(a.positionAbs||a.position.absolute).left+a.margins.left,f=(a.positionAbs||a.position.absolute).top+a.margins.top,
i=e+a.helperProportions.width,k=f+a.helperProportions.height,j=b.offset.left,g=b.offset.top,l=j+b.proportions().width,m=g+b.proportions().height;switch(c){case "fit":return j<=e&&i<=l&&g<=f&&k<=m;case "intersect":return j<e+a.helperProportions.width/2&&i-a.helperProportions.width/2<l&&g<f+a.helperProportions.height/2&&k-a.helperProportions.height/2<m;case "pointer":a=d.pageY;c=b.proportions().height;if(g=a>=g&&a<g+c)d=d.pageX,b=b.proportions().width,g=d>=j&&d<j+b;return g;case "touch":return(f>=g&&
f<=m||k>=g&&k<=m||f<g&&k>m)&&(e>=j&&e<=l||i>=j&&i<=l||e<j&&i>l);default:return!1}}}();d.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(a,b){var c,h,e=d.ui.ddmanager.droppables[a.options.scope]||[],f=b?b.type:null,i=(a.currentItem||a.element).find(":data(ui-droppable)").addBack();c=0;a:for(;c<e.length;c++)if(!(e[c].options.disabled||a&&!e[c].accept.call(e[c].element[0],a.currentItem||a.element))){for(h=0;h<i.length;h++)if(i[h]===e[c].element[0]){e[c].proportions().height=
0;continue a}e[c].visible="none"!==e[c].element.css("display");if(e[c].visible)"mousedown"===f&&e[c]._activate.call(e[c],b),e[c].offset=e[c].element.offset(),e[c].proportions({width:e[c].element[0].offsetWidth,height:e[c].element[0].offsetHeight})}},drop:function(a,b){var c=!1;d.each((d.ui.ddmanager.droppables[a.options.scope]||[]).slice(),function(){if(this.options&&(!this.options.disabled&&this.visible&&d.ui.intersect(a,this,this.options.tolerance,b)&&(c=this._drop.call(this,b)||c),!this.options.disabled&&
this.visible&&this.accept.call(this.element[0],a.currentItem||a.element)))this.isout=!0,this.isover=!1,this._deactivate.call(this,b)});return c},dragStart:function(a,b){a.element.parentsUntil("body").on("scroll.droppable",function(){a.options.refreshPositions||d.ui.ddmanager.prepareOffsets(a,b)})},drag:function(a,b){a.options.refreshPositions&&d.ui.ddmanager.prepareOffsets(a,b);d.each(d.ui.ddmanager.droppables[a.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var c,
h,e;e=d.ui.intersect(a,this,this.options.tolerance,b);var f=!e&&this.isover?"isout":e&&!this.isover?"isover":null;if(f){if(this.options.greedy&&(h=this.options.scope,e=this.element.parents(":data(ui-droppable)").filter(function(){return d(this).droppable("instance").options.scope===h}),e.length))c=d(e[0]).droppable("instance"),c.greedyChild="isover"===f;if(c&&"isover"===f)c.isover=!1,c.isout=!0,c._out.call(c,b);this[f]=!0;this["isout"===f?"isover":"isout"]=!1;this["isover"===f?"_over":"_out"].call(this,
b);if(c&&"isout"===f)c.isout=!1,c.isover=!0,c._over.call(c,b)}}})},dragStop:function(a,b){a.element.parentsUntil("body").off("scroll.droppable");a.options.refreshPositions||d.ui.ddmanager.prepareOffsets(a,b)}};!1!==d.uiBackCompat&&d.widget("ui.droppable",d.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super();this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super();this.options.activeClass&&this.element.removeClass(this.options.activeClass)},
_addHoverClass:function(){this._super();this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super();this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}});return d.ui.droppable});
