<?php

/** @var string $selector */
/** @var array $settings */

$background = array();
$background_size = array();
$background_attachment = array();

foreach (array_reverse($settings) as $layer) {
    switch ($layer['type']) {
        case 'color':
            if (count($settings) === 1) {
                $background[] = $layer['background_color'];
            } else {
                $background[] = "linear-gradient(to right, $layer[background_color], $layer[background_color])";
            }
            $background_size[] = '100% 100%';
            $background_attachment[] = 'initial';
            break;
        case 'file':
            $background[] = "url('$layer[background_url]') no-repeat center";
            $background_size[] = 'cover';
            $background_attachment[] = $layer['background_attachment'] ?: 'initial';
            break;
        case 'linear_gradient':
            $background[] = "linear-gradient({$layer['gradient_angle']}deg, {$layer['lgradient_color'][0]} 0%, {$layer['lgradient_color'][1]} 100%)";
            $background_size[] = '100% 100%';
            break;
        case 'radial_gradient':
            $background[] = "radial-gradient(ellipse at center, {$layer['rgradient_color'][0]} 0%, {$layer['rgradient_color'][1]} 100%)";
            $background_size[] = '100% 100%';
            $background_attachment[] = 'initial';
            break;
    }
}

if (!$background) {
    return '';
}

return "$selector {background: " . join(', ', $background) .
       ";background-size: " . join(', ', $background_size) .
       ";background-attachment: " . join(', ', $background_attachment) .
       ";}\n";